/*
 * Sails application launcher.
 *
 */

//==============================================================================

function initialize(sails, done) {
  //-- globals here...
  global.xhr = require("supertest")(sails.express.app);
  global.request = new (require("supertest-session")({app: sails.express.app}))();

  done();
}

//------------------------------------------------------------------------------

before(function(done) {
  require("sails").lift({
    //-- turn down the log level so we can view the test results
    log: {
      level: "silent"
    }
  }, function(err, sails) {
    if (err) return done(err);

    //-- post startup...
    initialize(sails, done);
  });
});

//------------------------------------------------------------------------------

after(function(done) {
  (typeof sails != "undefined") ? sails.lower(done) : done();
});
